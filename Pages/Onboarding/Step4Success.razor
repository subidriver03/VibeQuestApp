@page "/success"
@using VibeQuestApp.Data
@using Microsoft.EntityFrameworkCore
@inject NavigationManager NavigationManager
@inject UserSessionService Session
@inject AppDbContext Db


<h3>🎉 Account Created Successfully!</h3>

<div class="card p-3">
    @if (!string.IsNullOrEmpty(Session.CurrentUser?.AvatarUrl))
    {
        <img class="img-thumbnail mb-3"
             style="max-width: 300px; max-height: 300px; width: auto; height: auto; display: block; margin: 0 auto;"
             src="@Session.CurrentUser.AvatarUrl" alt="Avatar" />
    }

    <h4>Email: @Session.CurrentUser?.Email</h4>
    <p>
        Welcome to VibeQuest
        <strong>
            @GetHeroName()
        </strong>!
    </p>

    <button class="btn btn-primary mt-3" @onclick="GoToProfile">View Your Profile</button>
</div>

@code {
    private string? HeroName;

    protected override async Task OnInitializedAsync()
    {
        if (Session.CurrentUser is not null)
        {
            var profile = await Db.HeroProfiles
                .FirstOrDefaultAsync(p => p.UserId == Session.CurrentUser.Id);

            if (profile is not null)
            {
                HeroName = profile.HeroName;
            }
        }
    }

    private string GetHeroName() => string.IsNullOrEmpty(HeroName) ? "" : $" {HeroName}";

    private void GoToProfile()
    {
        NavigationManager.NavigateTo("/profile");
    }
}
